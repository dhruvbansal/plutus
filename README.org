#+TITLE:Plutus

* Data Model

The raw data for the blockchain is generated using two tools:

  - [[https://en.bitcoin.it/wiki/Bitcoind][bitcoind]] which downloads the blockchain and keeps it synced
  - [[https://github.com/mcdee/blockparser][blockparser]] which dumps the blockchain data to CSV format

Sample data from the output of blockparser (indeed, the first few 1000
blocks & transactions) is included in the [[file:data][data]] directory.  The
following command:

: $ head -n2 data/*.csv
: ==> data/blocks.csv <==
: ID,Hash,Version,Timestamp,Nonce,Difficulty,Merkle,NumTransactions,OutputValue,FeesValue,Size
: 0,"000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f",1,"2009-01-03T18:15:05Z",2083236893,1.000000,"4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b",1,5000000000,0,285
: 
: ==> data/inputs.csv <==
: TransactionId,Index,Script,OutputTxHash,OutputTxIndex
: 171,0,"01091d8d76a82122082246acbb6cc51c839d9012ddaca46048de07ca8eec221518200241cdb85fab4815c6c624d6e932774f3fdf5fa2a1d3a1614951afb83269e1454e2002443047","0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9",0
: 
: ==> data/outputs.csv <==
: TransactionId,Index,Value,Script,ReceivingAddress,InputTxHash,InputTxIndex
: 0,0,5000000000,"ac5f1df16b2b704c8a578d0bbaf74d385cde12c11ee50455f3c438ef4c3fbcf649b6de611feae06279a60939e028a8d65c10b73071a6f16719274855feb0fd8a670441","1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa",,
: 
: ==> data/transactions.csv <==
: ID,Hash,Version,BlockId,NumInputs,NumOutputs,OutputValue,FeesValue,LockTime,Size
: 0,"4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b",1,0,0,1,5000000000,0,3652501241,204

reveals the data model used by the blockchain.

Here is a simple diagram of these relationships:

:      TRANSACTION  <----- Contains ----  BLOCK
:   - id, hash, version               - id, hash, version, timestamp
:   - fees, output                    - difficulty, nonce, merkle*
:        |    ^                           |                     ^
:        |    |                           |                     |
:        |    |                           \------- parent ------/ 
:        |    |                            
:        |    \------ Input -----\         
:        |     - index            \                
:        |     - script            \---  ADDRESS
:        |     - output hash             - hash        ----> External
:        |     - output index      /-->  - balance           Signals...
:        |                        /      
:        \----------- Output ----/
:              - index
:              - script
:              - input Hash
:              - input Index
:              - value
:              - receiver address
: 

The data should be loaded in the following order:

  1. Blocks
  2. Transactions
  3. Inputs
  4. Outputs

** Schema

See the [[http://s3.thinkaurelius.com/docs/titan/current/schema.html][TitanDB schema docs]] for details:

*** Vertices

| Vertex Label | Property Key    | Property Key Data Type | Property Key Cardinality |
|--------------+-----------------+------------------------+--------------------------|
| Block        | ID              | Integer                | SINGLE                   |
|              | Hash            | String                 | SINGLE                   |
|              | Version         | Integer                | SINGLE                   |
|              | Timestamp       | String                 | SINGLE                   |
|              | Nonce           | String                 | SINGLE                   |
|              | Difficulty      | Float                  | SINGLE                   |
|              | Merkle          | String                 | SINGLE                   |
|              | NumTransactions | Integer                | SINGLE                   |
|              | OutputValue     | Float                  | SINGLE                   |
|              | FeesValue       | Float                  | SINGLE                   |
|              | Size            | Integer                | SINGLE                   |
|--------------+-----------------+------------------------+--------------------------|
| Transaction  | ID              | Integer                | SINGLE                   |
|              | Hash            | String                 | SINGLE                   |
|              | Version         | Integer                | SINGLE                   |
|              | NumInputs       | Integer                | SINGLE                   |
|              | NumOutputs      | Integer                | SINGLE                   |
|              | OutputValue     | Float                  | SINGLE                   |
|              | FeesValue       | Float                  | SINGLE                   |
|              | LockTime        | Integer                | SINGLE                   |
|              | Size            | Integer                | SINGLE                   |
|--------------+-----------------+------------------------+--------------------------|
| Address      | Hash            | String                 | SINGLE                   |
|              | Balance         | Float                  | SINGLE                   |
  
*** Edges

| Edge Label | Source Vertex Label | Target Vertex Label | Multiplicity | Property Key     | Property Key Data Type | Property Key Cardinality |
|------------+---------------------+---------------------+--------------+------------------+------------------------+--------------------------|
| parent     | Block               | Block               | SINGLE (?)   |                  |                        |                          |
|------------+---------------------+---------------------+--------------+------------------+------------------------+--------------------------|
| contains   | Block               | Transaction         | MANY2ONE     |                  |                        |                          |
|------------+---------------------+---------------------+--------------+------------------+------------------------+--------------------------|
| input      | Address             | Transaction         | MANY2ONE     | Index            | Integer                | SINGLE                   |
|            |                     |                     |              | Script           | String                 | SINGLE                   |
|            |                     |                     |              | OutputHash       | String                 | SINGLE                   |
|            |                     |                     |              | OutputIndex      | Inteer                 | SINGLE                   |
|------------+---------------------+---------------------+--------------+------------------+------------------------+--------------------------|
| output     | Transaction         | Address             | ONE2MANY     | Index            | Integer                | SINGLE                   |
|            |                     |                     |              | Script           | String                 | SINGLE                   |
|            |                     |                     |              | InputHash        | String                 | SINGLE                   |
|            |                     |                     |              | InputIndex       | Integer                | SINGLE                   |
|            |                     |                     |              | Value            | Float                  | SINGLE                   |
|            |                     |                     |              | Receiver Address | String                 | SINGLE                   |
